<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Will It Rain - Weather Prediction</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"
    />
    <style>
      :root {
        --color-temp-max: rgba(239, 68, 68, 0.4);
        --color-temp-max-line: #ef4444;
        --color-temp-min: rgba(59, 130, 246, 0.5);
        --color-temp-min-line: #3b82f6;
        --color-wind: rgba(96, 165, 250, 0.7);
        --color-wind-line: #3b82f6;
        --color-humidity: rgba(34, 197, 94, 0.7);
        --color-humidity-line: #16a34a;
        --color-precip: rgba(139, 92, 246, 0.7);
        --color-precip-line: #7c3aed;
        --color-uv: rgba(245, 158, 11, 0.7);
        --color-uv-line: #f59e0b;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Poppins", Tahoma, Geneva, Verdana, sans-serif;
        background: #1a1a1a;
        color: #333;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        background-image: url("Home.jpg");
      }
      header {
        background: linear-gradient(135deg, #7dd3fc 0%, #93c5fd 100%);
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 1100;
      }
      .logo {
        display: flex;
        flex-direction: column;
        font-weight: bold;
        color: #1e293b;
        line-height: 1.2;
      }
      .logo-will {
        font-size: 14px;
        letter-spacing: 2px;
      }
      .logo-rain {
        font-size: 16px;
        letter-spacing: 2px;
      }
      nav {
        display: flex;
        gap: 30px;
        align-items: center;
      }
      nav a {
        color: #1e293b;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
      }
      nav a:hover {
        color: #0f172a;
      }

      /* Mobile Menu Styles */
      .hamburger {
        display: none;
        flex-direction: column;
        gap: 5px;
        cursor: pointer;
        padding: 10px;
        z-index: 1200;
      }
      .hamburger span {
        width: 25px;
        height: 3px;
        background: #1e293b;
        transition: all 0.3s ease-in-out;
      }
      .hamburger.active span:nth-child(1) {
        transform: translateY(8px) rotate(45deg);
      }
      .hamburger.active span:nth-child(2) {
        opacity: 0;
      }
      .hamburger.active span:nth-child(3) {
        transform: translateY(-8px) rotate(-45deg);
      }

      .mobile-menu {
        display: flex;
        position: fixed;
        top: 0;
        right: -100%;
        width: 280px;
        height: 100%;
        background: linear-gradient(165deg, #7dd3fc 0%, #93c5fd 100%);
        z-index: 1150;
        flex-direction: column;
        align-items: center;
        padding-top: 100px;
        gap: 30px;
        transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.2);
      }
      .mobile-menu.active {
        right: 0;
      }
      .mobile-menu a {
        color: #1e293b;
        text-decoration: none;
        font-size: 20px;
        font-weight: 500;
      }

      main {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
        width: 100%;
        flex-grow: 1;
      }
      .hero {
        background: linear-gradient(
          135deg,
          rgba(45, 55, 72, 0.95) 0%,
          rgba(30, 41, 59, 0.9) 100%
        );
        border-radius: 15px;
        padding: 80px 40px;
        text-align: center;
        min-height: 500px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
      }
      .hero h1 {
        font-size: 48px;
        margin-bottom: 20px;
        font-weight: bold;
      }
      .hero p {
        font-size: 20px;
        margin-bottom: 30px;
        opacity: 0.9;
      }
      .btn-primary {
        background: #7dd3fc;
        color: #1e293b;
        padding: 15px 40px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }
      .btn-primary:hover {
        background: #93c5fd;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(125, 211, 252, 0.4);
      }
      .about-section {
        background: linear-gradient(135deg, #64748b 0%, #94a3b8 100%);
        border-radius: 15px;
        padding: 60px 20px;
        color: white;
      }
      .about-section h2 {
        font-size: 32px;
        margin-bottom: 20px;
      }
      .about-section p {
        font-size: 16px;
        line-height: 1.6;
        max-width: 800px;
      }
      .map-section {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-top: 30px;
      }
      .search-bar {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      .search-bar input {
        flex: 1;
        padding: 12px 20px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        font-size: 14px;
      }
      .search-bar button {
        padding: 12px 20px;
        background: #7dd3fc;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        color: #1e293b;
      }
      .btn-location {
        padding: 12px 20px;
        background: #34d399;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        color: white;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
        width: 100%;
        justify-content: center;
      }
      #map {
        width: 100%;
        height: 400px;
        border-radius: 10px;
        margin-bottom: 20px;
        z-index: 1;
      }
      .nasa-input-section {
        background: #f8fafc;
        padding: 25px;
        border-radius: 10px;
        margin-bottom: 20px;
      }
      .nasa-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }
      .nasa-header h3 {
        color: #1e293b;
        font-size: 20px;
      }
      .nasa-badge {
        background: linear-gradient(135deg, #7dd3fc 0%, #93c5fd 100%);
        color: #1e293b;
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 11px;
        font-weight: bold;
      }
      .input-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }
      .input-group {
        display: flex;
        flex-direction: column;
      }
      .input-group label {
        color: #64748b;
        font-size: 12px;
        font-weight: 600;
        margin-bottom: 5px;
      }
      .input-group input {
        padding: 10px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s;
      }
      .input-group input:focus {
        outline: none;
        border-color: #7dd3fc;
      }
      #weatherGraphsContainer {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 20px;
        margin-top: 10px;
        margin-bottom: 20px;
      }
      .weather-graph {
        background: #fff;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 15px;
        position: relative;
        overflow: hidden;
      }
      .graph-title {
        font-size: 14px;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 10px;
      }
      .chart-svg {
        width: 100%;
        height: 160px;
        font-size: 10px;
      }
      .grid-line {
        stroke: #f1f5f9;
        stroke-width: 1;
      }
      .axis-label {
        fill: #94a3b8;
        font-weight: 500;
      }
      .area-path {
        stroke: none;
      }
      .line-path {
        stroke-width: 2;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
      }
      .tracker-line {
        stroke: #94a3b8;
        stroke-width: 1;
        stroke-dasharray: 4, 2;
      }
      .graph-tooltip {
        position: absolute;
        background: rgba(30, 41, 59, 0.9);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        pointer-events: none;
        top: 15px;
        left: 15px;
        opacity: 0;
        transition: opacity 0.2s;
        white-space: nowrap;
        z-index: 10;
      }
      .graph-tooltip span {
        display: block;
      }
      .tooltip-line {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .tooltip-color-box {
        width: 10px;
        height: 10px;
        border-radius: 2px;
      }
      .btn-predict {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #7dd3fc 0%, #93c5fd 100%);
        color: #1e293b;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
      }
      .btn-predict:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(125, 211, 252, 0.4);
      }
      .results-section {
        background: white;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        display: none;
      }
      .results-section.show {
        display: block;
      }
      .results-header {
        color: #1e293b;
        font-size: 18px;
        margin-bottom: 15px;
        font-weight: 600;
      }
      .result-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        background: #f8fafc;
        border-radius: 8px;
        margin-bottom: 10px;
      }
      .result-label {
        color: #64748b;
        font-size: 14px;
      }
      .result-value {
        color: #1e293b;
        font-weight: 600;
        font-size: 14px;
      }
      /* Team Section Simplified */
      .team-section {
        background: white;
        border-radius: 15px;
        padding: 60px 40px;
      }
      .team-section h2 {
        font-size: 32px;
        margin-bottom: 10px;
        color: #1e293b;
        text-align: center;
      }
      .team-subtitle {
        text-align: center;
        color: #64748b;
        margin-bottom: 40px;
        font-size: 16px;
      }
      .team-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 30px;
        justify-content: center;
      }
      .team-member {
        text-align: center;
        background: #f8fafc;
        padding: 20px;
        border-radius: 10px;
      }
      .member-name {
        color: #1e293b;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 12px;
      }
      .social-link {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #eef2ff;
        transition: all 0.3s;
        text-decoration: none;
      }
      .social-link.linkedin {
        color: #0077b5;
      }
      .social-link:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      .social-link.linkedin:hover {
        background: #0077b5;
        color: white;
      }

      footer {
        background: linear-gradient(135deg, #7dd3fc 0%, #93c5fd 100%);
        padding: 20px;
        text-align: center;
        margin-top: 50px;
      }
      .footer-logo {
        display: inline-flex;
        flex-direction: column;
        font-weight: bold;
        color: #1e293b;
        line-height: 1.2;
        margin-bottom: 10px;
      }
      .hidden {
        display: none;
      }
      @media (max-width: 768px) {
        nav {
          display: none;
        }
        .hamburger {
          display: flex;
        }
        .hero h1 {
          font-size: 32px;
        }
        .input-grid {
          grid-template-columns: 1fr;
        }
        .team-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo">
        <span class="logo-will">WILL IT</span>
        <span class="logo-rain">RAIN</span>
      </div>
      <nav id="desktopNav">
        <a href="#" data-page="home">Home</a>
        <a href="#" data-page="about">About</a>
        <a href="#" data-page="contact">Contact Us</a>
      </nav>
      <div class="hamburger" id="hamburger">
        <span></span> <span></span> <span></span>
      </div>
    </header>

    <div class="mobile-menu" id="mobileMenu">
      <a href="#" data-page="home">Home</a>
      <a href="#" data-page="about">About</a>
      <a href="#" data-page="contact">Contact Us</a>
    </div>

    <main>
      <section id="homePage" class="page-content">
        <div class="hero">
          <div class="hero-content">
            <h1>WILL IT<br />RAIN?</h1>
            <p>Knows weather anytime, anywhere!</p>
            <button class="btn-primary" id="startPredicting">
              Start Predicting
            </button>
          </div>
        </div>
      </section>
      <section id="aboutPage" class="page-content hidden">
        <div class="about-section">
          <h2>About Will It Rain</h2>
          <p>
            Ever planned a picnic, a hike, or a simple walk, only to be caught
            in an unexpected downpour? Traditional weather forecasts give you
            the picture for a whole city, but weather can be dramatically
            different just a few kilometers away. We believed there had to be a
            better, more precise way.
          </p>
        </div>
      </section>
      <section id="mapsPage" class="page-content hidden">
        <div class="map-section">
          <button class="btn-location" onclick="getCurrentLocation()">
            📍 Use My Current Location
          </button>
          <div class="search-bar">
            <input
              type="text"
              id="searchInput"
              placeholder="Search location (e.g., Bandung, Indonesia)"
              value=""
            />
            <button onclick="searchLocation()">🔍 Search</button>
          </div>
          <div id="map"></div>
          <div class="nasa-input-section">
            <div class="nasa-header">
              <h3>NASA Weather Parameters</h3>
              <span class="nasa-badge">NASA GIBS DATA</span>
            </div>
            <div class="input-grid">
              <div class="input-group">
                <label>📅 Start Date</label>
                <input type="date" id="nasaStartDate" />
              </div>
              <div class="input-group">
                <label>📅 End Date</label>
                <input type="date" id="nasaEndDate" />
              </div>
              <div class="input-group">
                <label>🌍 Latitude</label>
                <input type="number" id="nasaLat" step="0.000001" readonly />
              </div>
              <div class="input-group">
                <label>🌍 Longitude</label>
                <input type="number" id="nasaLon" step="0.000001" readonly />
              </div>
            </div>
            <div id="weatherGraphsContainer"></div>
            <button class="btn-predict" onclick="getWeatherPrediction()">
              🚀 Analyze Weather & Predict
            </button>
          </div>
          <div class="results-section" id="resultsSection">
            <div class="results-header">📊 Prediction Results</div>
            <div id="resultsContent"></div>
          </div>
        </div>
      </section>
      <section id="contactPage" class="page-content hidden">
        <div class="team-section">
          <h2>Our Team</h2>
          <p class="team-subtitle">Meet the people behind Will It Rain</p>
          <div class="team-grid">
            <div class="team-member">
              <div class="member-info">
                <h3 class="member-name">Alexander Bagus Wijanarko</h3>
                <div class="member-links">
                  <a
                    href="https://www.linkedin.com/in/alexander-bagus-wijanarko-506b93328/"
                    target="_blank"
                    class="social-link linkedin"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"
                      />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
            <div class="team-member">
              <div class="member-info">
                <h3 class="member-name">Albert Nicholas Chandra</h3>
                <div class="member-links">
                  <a
                    href="https://www.linkedin.com/in/albert-nicholas-c-064284327/"
                    target="_blank"
                    class="social-link linkedin"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"
                      />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
            <div class="team-member">
              <div class="member-info">
                <h3 class="member-name">Anselmus William Putra Adji</h3>
                <div class="member-links">
                  <a
                    href="https://www.linkedin.com/in/anselmus-william-putra-adji-a265482bb/"
                    target="_blank"
                    class="social-link linkedin"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"
                      />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
            <div class="team-member">
              <div class="member-info">
                <h3 class="member-name">Michael Irvin Wartju</h3>
                <div class="member-links">
                  <a
                    href="https://www.linkedin.com/in/michaelirvinwartju?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app"
                    target="_blank"
                    class="social-link linkedin"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"
                      />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
            <div class="team-member">
              <div class="member-info">
                <h3 class="member-name">Mikhael Filemon</h3>
                <div class="member-links">
                  <a
                    href="https://www.linkedin.com/in/kainefm/"
                    target="_blank"
                    class="social-link linkedin"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"
                      />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <footer>
      <div class="footer-logo">
        <span class="logo-will">WILL IT</span>
        <span class="logo-rain">RAIN</span>
      </div>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
      let map,
        marker,
        rangeDataCache = [];
      let currentLat = -6.9024942,
        currentLng = 107.5607453;

      const startDateInput = document.getElementById("nasaStartDate");
      const endDateInput = document.getElementById("nasaEndDate");
      const hamburger = document.getElementById("hamburger");
      const mobileMenu = document.getElementById("mobileMenu");

      function formatDate(date) {
        return date.toISOString().split("T")[0];
      }

      function setupDatePickers() {
        const today = new Date("2025-10-05T17:05:38");
        const weekAgo = new Date(today);
        weekAgo.setDate(today.getDate() - 6);

        endDateInput.value = formatDate(today);
        startDateInput.value = formatDate(weekAgo);

        const handleDateChange = () => {
          const start = new Date(startDateInput.value);
          const end = new Date(endDateInput.value);
          if (end < start) {
            startDateInput.value = endDateInput.value;
          }
          const diffTime = Math.abs(end - start);
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          if (diffDays > 13) {
            alert("Please select a date range of 14 days or less.");
            const newStart = new Date(end);
            newStart.setDate(end.getDate() - 13);
            startDateInput.value = formatDate(newStart);
          }
          getWeatherPrediction();
        };

        startDateInput.addEventListener("change", handleDateChange);
        endDateInput.addEventListener("change", handleDateChange);
      }
      setupDatePickers();

      const pages = {
        home: document.getElementById("homePage"),
        about: document.getElementById("aboutPage"),
        maps: document.getElementById("mapsPage"),
        contact: document.getElementById("contactPage"),
      };
      function showPage(pageName) {
        Object.values(pages).forEach((page) => page.classList.add("hidden"));
        if (pages[pageName]) {
          pages[pageName].classList.remove("hidden");
          if (pageName === "maps" && !map) {
            setTimeout(() => initMap(), 100);
          }
        }
        mobileMenu.classList.remove("active");
        hamburger.classList.remove("active");
      }
      document
        .querySelectorAll("#desktopNav a, .mobile-menu a")
        .forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            showPage(e.target.dataset.page);
          });
        });
      hamburger.addEventListener("click", () => {
        hamburger.classList.toggle("active");
        mobileMenu.classList.toggle("active");
      });
      document
        .getElementById("startPredicting")
        .addEventListener("click", () => showPage("maps"));

      function initMap() {
        map = L.map("map").setView([currentLat, currentLng], 13);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution: "© OpenStreetMap contributors",
          maxZoom: 19,
        }).addTo(map);
        marker = L.marker([currentLat, currentLng], { draggable: true })
          .addTo(map)
          .bindPopup("<b>Selected Location</b>")
          .openPopup();
        marker.on("dragend", (e) =>
          updateLocationInfo(e.target.getLatLng().lat, e.target.getLatLng().lng)
        );
        map.on("click", (e) => {
          marker.setLatLng(e.latlng);
          updateLocationInfo(e.latlng.lat, e.latlng.lng);
        });
        updateLocationInfo(currentLat, currentLng);
      }
      function getCurrentLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition((position) => {
            const { latitude: lat, longitude: lng } = position.coords;
            map.setView([lat, lng], 14);
            marker.setLatLng([lat, lng]);
            updateLocationInfo(lat, lng);
          });
        } else {
          alert("Geolocation is not supported by your browser.");
        }
      }
      async function searchLocation() {
        const query = document.getElementById("searchInput").value;
        if (!query) return;
        try {
          const response = await fetch(
            `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(
              query
            )}`
          );
          const data = await response.json();
          if (data && data.length > 0) {
            const lat = parseFloat(data[0].lat);
            const lng = parseFloat(data[0].lon);
            map.setView([lat, lng], 13);
            marker.setLatLng([lat, lng]);
            updateLocationInfo(lat, lng);
          } else {
            alert("Location not found.");
          }
        } catch (error) {
          console.error("Search error:", error);
        }
      }
      function updateLocationInfo(lat, lng) {
        currentLat = lat;
        currentLng = lng;
        document.getElementById("nasaLat").value = lat.toFixed(7);
        document.getElementById("nasaLon").value = lng.toFixed(7);
      }
      document
        .getElementById("searchInput")
        .addEventListener("keypress", (e) => {
          if (e.key === "Enter") searchLocation();
        });

      async function fetchDataForDateRange(startDateStr, endDateStr) {
        const allData = [
          {
            date: "2025-09-22",
            temperature: { min: 21, max: 29 },
            windSpeed: 22,
            humidity: 82,
            precipProb: 30,
            uvIndex: 9,
          },
          {
            date: "2025-09-23",
            temperature: { min: 22, max: 30 },
            windSpeed: 19,
            humidity: 85,
            precipProb: 40,
            uvIndex: 8,
          },
          {
            date: "2025-09-24",
            temperature: { min: 22, max: 28 },
            windSpeed: 25,
            humidity: 90,
            precipProb: 60,
            uvIndex: 7,
          },
          {
            date: "2025-09-25",
            temperature: { min: 21, max: 27 },
            windSpeed: 28,
            humidity: 95,
            precipProb: 85,
            uvIndex: 5,
          },
          {
            date: "2025-09-26",
            temperature: { min: 21, max: 28 },
            windSpeed: 35,
            humidity: 98,
            precipProb: 95,
            uvIndex: 4,
          },
          {
            date: "2025-09-27",
            temperature: { min: 22, max: 30 },
            windSpeed: 24,
            humidity: 92,
            precipProb: 75,
            uvIndex: 6,
          },
          {
            date: "2025-09-28",
            temperature: { min: 23, max: 31 },
            windSpeed: 20,
            humidity: 88,
            precipProb: 50,
            uvIndex: 8,
          },
          {
            date: "2025-09-29",
            temperature: { min: 23, max: 32 },
            windSpeed: 18,
            humidity: 85,
            precipProb: 30,
            uvIndex: 10,
          },
          {
            date: "2025-09-30",
            temperature: { min: 22, max: 30 },
            windSpeed: 25,
            humidity: 90,
            precipProb: 65,
            uvIndex: 8,
          },
          {
            date: "2025-10-01",
            temperature: { min: 21, max: 28 },
            windSpeed: 29,
            humidity: 96,
            precipProb: 90,
            uvIndex: 6,
          },
          {
            date: "2025-10-02",
            temperature: { min: 21, max: 27 },
            windSpeed: 34,
            humidity: 98,
            precipProb: 95,
            uvIndex: 4,
          },
          {
            date: "2025-10-03",
            temperature: { min: 22, max: 29 },
            windSpeed: 26,
            humidity: 94,
            precipProb: 80,
            uvIndex: 7,
          },
          {
            date: "2025-10-04",
            temperature: { min: 22, max: 31 },
            windSpeed: 19,
            humidity: 88,
            precipProb: 50,
            uvIndex: 9,
          },
          {
            date: "2025-10-05",
            temperature: { min: 23, max: 32 },
            windSpeed: 21,
            humidity: 89,
            precipProb: 70,
            uvIndex: 8,
          },
        ];
        const start = new Date(startDateStr);
        const end = new Date(endDateStr);
        const result = allData.filter((d) => {
          const date = new Date(d.date);
          return date >= start && date <= end;
        });
        return Promise.resolve(result);
      }

      function displayDataCharts(rangeData, selectedDate) {
        const container = document.getElementById("weatherGraphsContainer");
        container.innerHTML = "";

        const parameters = [
          {
            key: "temperature",
            title: "Temperature (°C)",
            unit: "°C",
            type: "min-max",
            colors: {
              min: "var(--color-temp-min)",
              max: "var(--color-temp-max)",
            },
            lines: {
              min: "var(--color-temp-min-line)",
              max: "var(--color-temp-max-line)",
            },
          },
          {
            key: "windSpeed",
            title: "Max Wind Speed (km/h)",
            unit: " km/h",
            type: "max-only",
            color: "var(--color-wind)",
            line: "var(--color-wind-line)",
          },
          {
            key: "humidity",
            title: "Max Humidity (%)",
            unit: "%",
            type: "max-only",
            color: "var(--color-humidity)",
            line: "var(--color-humidity-line)",
          },
          {
            key: "precipProb",
            title: "Max Precipitation Prob. (%)",
            unit: "%",
            type: "max-only",
            color: "var(--color-precip)",
            line: "var(--color-precip-line)",
          },
          {
            key: "uvIndex",
            title: "Max UV Index",
            unit: "",
            type: "max-only",
            color: "var(--color-uv)",
            line: "var(--color-uv-line)",
          },
        ];

        if (rangeData.length < 2) {
          container.innerHTML =
            '<p style="text-align: center; padding: 20px;">Please select a range of at least 2 days to display graphs.</p>';
          return;
        }
        const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

        parameters.forEach((param) => {
          const svgWidth = 320,
            svgHeight = 160,
            p = { top: 10, right: 10, bottom: 30, left: 35 };
          let overallMin, overallMax;

          if (param.type === "min-max") {
            const allValues = rangeData.flatMap((day) => [
              day.temperature.min,
              day.temperature.max,
            ]);
            overallMin = Math.min(...allValues);
            overallMax = Math.max(...allValues);
          } else {
            const allValues = rangeData.map((day) => day[param.key]);
            overallMin = 0; // Start max-only charts from baseline
            overallMax = Math.max(...allValues);
          }
          const valueRange = overallMax - overallMin;

          const getCoords = (value, index) => {
            const x =
              p.left +
              (index / (rangeData.length - 1)) * (svgWidth - p.left - p.right);
            let y = svgHeight - p.bottom;
            if (valueRange > 0) {
              y =
                svgHeight -
                p.bottom -
                ((value - overallMin) / valueRange) *
                  (svgHeight - p.top - p.bottom);
            }
            return { x, y };
          };

          let yAxisHTML = "",
            xAxisHTML = "",
            areaPaths = "",
            linePaths = "";
          for (let i = 0; i <= 4; i++) {
            const y =
              svgHeight - p.bottom - (i / 4) * (svgHeight - p.top - p.bottom);
            const value = Math.round(overallMin + (i / 4) * valueRange);
            yAxisHTML += `<line x1="${p.left}" y1="${y}" x2="${
              svgWidth - p.right
            }" y2="${y}" class="grid-line" /><text x="${p.left - 5}" y="${
              y + 3
            }" class="axis-label" text-anchor="end">${value}</text>`;
          }
          rangeData.forEach((day, i) => {
            const { x } = getCoords(0, i);
            const dayName = dayNames[new Date(day.date + "T00:00:00").getDay()];
            xAxisHTML += `<text x="${x}" y="${
              svgHeight - p.bottom + 15
            }" class="axis-label" text-anchor="middle">${dayName}</text>`;
          });

          if (param.type === "min-max") {
            const topPoints = rangeData.map((d, i) =>
              getCoords(d.temperature.max, i)
            );
            const bottomPoints = rangeData
              .map((d, i) => getCoords(d.temperature.min, i))
              .reverse();
            const areaD =
              "M" +
              topPoints
                .map((p) => `${p.x.toFixed(2)},${p.y.toFixed(2)}`)
                .join(" L ") +
              " L" +
              bottomPoints
                .map((p) => `${p.x.toFixed(2)},${p.y.toFixed(2)}`)
                .join(" L ") +
              " Z";
            areaPaths = `<path class="area-path" d="${areaD}" style="fill:${param.colors.max};"></path>`;
            const minLineD =
              "M" +
              rangeData
                .map((day, i) => {
                  const { x, y } = getCoords(day.temperature.min, i);
                  return `${x.toFixed(2)},${y.toFixed(2)}`;
                })
                .join(" L ");
            const maxLineD =
              "M" +
              rangeData
                .map((day, i) => {
                  const { x, y } = getCoords(day.temperature.max, i);
                  return `${x.toFixed(2)},${y.toFixed(2)}`;
                })
                .join(" L ");
            linePaths = `<path class="line-path" d="${maxLineD}" style="stroke:${param.lines.max};"></path><path class="line-path" d="${minLineD}" style="stroke:${param.lines.min};"></path>`;
          } else {
            const topPoints = rangeData.map((d, i) =>
              getCoords(d[param.key], i)
            );
            const baselineY = svgHeight - p.bottom;
            const areaD =
              "M" +
              topPoints
                .map((p) => `${p.x.toFixed(2)},${p.y.toFixed(2)}`)
                .join(" L ") +
              ` L${topPoints[topPoints.length - 1].x.toFixed(
                2
              )},${baselineY} L${topPoints[0].x.toFixed(2)},${baselineY} Z`;
            areaPaths = `<path class="area-path" d="${areaD}" style="fill:${param.color};"></path>`;
            const lineD =
              "M" +
              topPoints
                .map((p) => `${p.x.toFixed(2)},${p.y.toFixed(2)}`)
                .join(" L ");
            linePaths = `<path class="line-path" d="${lineD}" style="stroke:${param.line};"></path>`;
          }

          const graphHTML = `<div class="weather-graph" id="graph-${
            param.key
          }"><div class="graph-title">${
            param.title
          }</div><div class="graph-tooltip" id="tooltip-${
            param.key
          }"></div><svg viewBox="0 0 ${svgWidth} ${svgHeight}" class="chart-svg" aria-label="${
            param.title
          }"><g class="grid-and-axis">${yAxisHTML}${xAxisHTML}</g>${areaPaths}${linePaths}<line class="tracker-line" id="tracker-${
            param.key
          }" y1="${p.top}" y2="${
            svgHeight - p.bottom
          }" style="opacity:0;"></line><line class="tracker-line" id="selected-day-line-${
            param.key
          }" y1="${p.top}" y2="${
            svgHeight - p.bottom
          }" style="stroke-width:1.5; stroke:#1e293b; opacity: 0;"></line></svg></div>`;
          container.insertAdjacentHTML("beforeend", graphHTML);

          const graphEl = document.getElementById(`graph-${param.key}`),
            svgEl = graphEl.querySelector(".chart-svg"),
            tooltipEl = document.getElementById(`tooltip-${param.key}`),
            trackerEl = document.getElementById(`tracker-${param.key}`);
          svgEl.addEventListener("mousemove", (e) => {
            const rect = svgEl.getBoundingClientRect(),
              mouseX = e.clientX - rect.left,
              dayIndex = Math.round(
                ((mouseX - p.left) / (svgWidth - p.left - p.right)) *
                  (rangeData.length - 1)
              );
            if (dayIndex >= 0 && dayIndex < rangeData.length) {
              const dayData = rangeData[dayIndex],
                { x } = getCoords(0, dayIndex);
              trackerEl.setAttribute("x1", x);
              trackerEl.setAttribute("x2", x);
              trackerEl.style.opacity = "1";
              tooltipEl.style.opacity = "1";
              tooltipEl.style.left = `${Math.min(
                x + 15,
                rect.width - tooltipEl.offsetWidth
              )}px`;
              tooltipEl.style.top = `15px`;
              if (param.type === "min-max") {
                tooltipEl.innerHTML = `<strong>${dayData.date}</strong><div class="tooltip-line"><div class="tooltip-color-box" style="background:${param.lines.max};"></div>Max: ${dayData.temperature.max}${param.unit}</div><div class="tooltip-line"><div class="tooltip-color-box" style="background:${param.lines.min};"></div>Min: ${dayData.temperature.min}${param.unit}</div>`;
              } else {
                tooltipEl.innerHTML = `<strong>${
                  dayData.date
                }</strong><div class="tooltip-line"><div class="tooltip-color-box" style="background:${
                  param.line
                };"></div>Max: ${dayData[param.key]}${param.unit}</div>`;
              }
            }
          });
          svgEl.addEventListener("mouseleave", () => {
            trackerEl.style.opacity = "0";
            tooltipEl.style.opacity = "0";
          });
          const selectedDayIndex = rangeData.findIndex(
            (d) => d.date === selectedDate
          );
          if (selectedDayIndex !== -1) {
            const { x } = getCoords(0, selectedDayIndex),
              selectedDayLine = document.getElementById(
                `selected-day-line-${param.key}`
              );
            selectedDayLine.setAttribute("x1", x);
            selectedDayLine.setAttribute("x2", x);
            selectedDayLine.style.opacity = "1";
          }
        });
      }

      async function getWeatherPrediction() {
        document.getElementById("resultsSection").classList.remove("show");
        document.getElementById("weatherGraphsContainer").innerHTML =
          '<p style="text-align: center; padding: 20px;">Analyzing data for the selected range...</p>';
        rangeDataCache = await fetchDataForDateRange(
          startDateInput.value,
          endDateInput.value
        );
        if (rangeDataCache.length === 0) {
          document.getElementById("weatherGraphsContainer").innerHTML =
            '<p style="text-align: center; padding: 20px;">No data available for this date range.</p>';
          return;
        }
        const selectedDate = endDateInput.value;
        displayDataCharts(rangeDataCache, selectedDate);
        updatePredictionForDay(selectedDate);
      }

      function updatePredictionForDay(dateString) {
        if (!rangeDataCache.length) return;
        const dayData = rangeDataCache.find((d) => d.date === dateString);
        if (!dayData) {
          console.error("No data for date:", dateString);
          return;
        }
        let prediction, confidence, conditions;
        if (dayData.precipProb > 75) {
          prediction = "Heavy Rain";
          confidence = "88%";
          conditions = `High chance of precipitation with temps between ${dayData.temperature.min}-${dayData.temperature.max}°C.`;
        } else if (dayData.precipProb > 40) {
          prediction = "Scattered Showers";
          confidence = "70%";
          conditions = `Cloudy with an average humidity of ${dayData.humidity}%.`;
        } else if (dayData.temperature.max > 30 && dayData.precipProb < 30) {
          prediction = "Hot and Sunny";
          confidence = "90%";
          conditions = `High UV Index of ${dayData.uvIndex}. Stay hydrated.`;
        } else {
          prediction = "Partly Cloudy";
          confidence = "85%";
          conditions = "Pleasant weather with mild temperatures.";
        }
        displayPredictionResults({
          prediction,
          confidence,
          date: dateString,
          conditions,
        });
      }

      function displayPredictionResults(data) {
        document.getElementById(
          "resultsHeader"
        ).textContent = `📊 Prediction Results for ${data.date}`;
        const resultsContent = document.getElementById("resultsContent");
        resultsContent.innerHTML = `
          <div class="result-item"> <span class="result-label">Prediction:</span> <span class="result-value">${
            data.prediction || "N/A"
          }</span> </div>
          <div class="result-item"> <span class="result-label">Confidence:</span> <span class="result-value">${
            data.confidence || "N/A"
          }</span> </div>
          <div class="result-item"> <span class="result-label">Conditions:</span> <span class="result-value">${
            data.conditions || "N/A"
          }</span> </div>
        `;
        document.getElementById("resultsSection").classList.add("show");
      }
    </script>
  </body>
</html>
